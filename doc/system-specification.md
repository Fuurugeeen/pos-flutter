# 飲食店顧客管理・会計システム仕様書

## 1. システム概要

### 1.1 目的
小規模飲食店向けの顧客管理と会計処理を統合したPOSシステム

### 1.2 主要機能
- 会員管理（登録・検索・ポイント管理）
- 商品販売・会計処理
- 在庫管理
- 売上分析・レポート出力
- 複数端末対応

## 2. 機能要件

### 2.1 会員管理機能

#### 2.1.1 会員情報
- 会員ID（自動採番）
- 氏名（姓・名）
- 電話番号
- メールアドレス
- 性別
- 生年月日
- ポイント残高
- 登録日時
- 最終来店日

#### 2.1.2 会員特典
- ポイント付与率設定（購入金額の〇%）
- ポイント利用（1ポイント=1円）
- 誕生日特典設定

### 2.2 商品管理機能

#### 2.2.1 商品カテゴリ
- ドリンク
- フード
  - 前菜
  - メイン
  - デザート
- テイクアウト専用

#### 2.2.2 商品情報
- 商品ID
- 商品名
- カテゴリ
- 単価
- 原価
- 税区分（外税/内税）
- 税率（8%/10%）
- 在庫管理対象フラグ
- テイクアウト可否

### 2.3 会計機能

#### 2.3.1 注文処理
- 商品選択（カテゴリ別表示）
- 数量指定
- イートイン/テイクアウト選択（税率自動切替）
- 会員検索・ポイント利用
- 小計・税額・合計表示

#### 2.3.2 決済方法
- 現金
- クレジットカード
- 電子マネー
- ポイント利用
- 併用決済対応

#### 2.3.3 割り勘機能
- 人数指定
- 均等割り
- 個別指定

#### 2.3.4 税計算設定
- 税区分：外税/内税
- 端数処理：切り上げ/切り捨て/四捨五入
- 税率：8%（テイクアウト）/10%（イートイン）

### 2.4 在庫管理機能

#### 2.4.1 在庫情報
- 商品別現在庫数
- 入庫履歴
- 出庫履歴（販売・廃棄）
- 在庫アラート設定

### 2.5 レポート機能

#### 2.5.1 売上レポート
- 日別/月別/年別売上
- 商品別売上
- カテゴリ別売上
- 時間帯別売上
- 決済方法別集計

#### 2.5.2 会計レポート
- 売上高
- 原価
- 粗利（金額・率）
- 税率別消費税額
- 外税/内税別集計

#### 2.5.3 Excel出力
- 日付範囲指定
- 売上明細
- 商品別集計
- 会員別購買履歴

### 2.6 伝票参照機能

#### 2.6.1 伝票検索
- 伝票番号検索
- 期間指定検索（日付範囲）
- 会員名検索（部分一致）
- 金額範囲検索（○○円以上○○円以下）
- 決済方法絞り込み
- 店舗・端末絞り込み
- 伝票状態絞り込み（完了/返品済み/キャンセル）

#### 2.6.2 伝票一覧表示
- 伝票番号、日時、会員名、金額、決済方法、状態
- ページネーション対応
- ソート機能（日時、金額順）
- Excel出力機能

#### 2.6.3 伝票詳細表示
- 基本情報（日時、担当者、端末、会員情報）
- 注文内容詳細（商品名、数量、単価、税額）
- 税込・税抜・消費税額の内訳
- 決済情報（決済方法、お預り金、お釣り）
- ポイント情報（利用・付与）

#### 2.6.4 レシートイメージ表示
- 実際のレシート形式での表示
- 店舗情報（店舗名、住所、電話番号）
- 全商品の詳細情報と税額内訳
- ポイント情報表示
- 印刷・PDF保存・メール送信機能

#### 2.6.5 返品・交換対応
- 伝票から返品処理開始
- 一部返品・全返品対応
- 返品理由入力
- 返品伝票自動生成

### 2.7 システム設定

#### 2.7.1 店舗設定
- 店舗ID
- 店舗名
- 住所
- 電話番号

#### 2.7.2 端末設定
- 端末No
- 端末名称
- レジ担当者

## 3. 画面設計

### 3.1 メイン画面（ダッシュボード）

```
┌─────────────────────────────────────────────────┐
│ POSシステム        店舗：〇〇店  端末：01  担当：山田 │
├─────────────────────────────────────────────────┤
│                                                 │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐       │
│  │         │  │         │  │         │       │
│  │  会計   │  │ 会員管理 │  │ 商品管理 │       │
│  │         │  │         │  │         │       │
│  └─────────┘  └─────────┘  └─────────┘       │
│                                                 │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐       │
│  │         │  │         │  │         │       │
│  │ 在庫管理 │  │ レポート │  │  設定   │       │
│  │         │  │         │  │         │       │
│  └─────────┘  └─────────┘  └─────────┘       │
│                                                 │
│  本日の売上：¥125,000  客数：45人              │
│                                                 │
└─────────────────────────────────────────────────┘
```

### 3.2 会計画面

```
┌─────────────────────────────────────────────────────────────┐
│ 会計          イートイン ○  テイクアウト ○     会員検索 🔍  │
├──────────────────────────┬──────────────────────────────────┤
│ カテゴリ                 │ 注文内容                          │
│ ┌──────┐               │ ┌────────────────────────────┐ │
│ │ドリンク│               │ │商品名      数量  単価   金額│ │
│ └──────┘               │ ├────────────────────────────┤ │
│ ┌──────┐               │ │コーヒー     2   ¥400   ¥800│ │
│ │ フード │               │ │サンドイッチ  1   ¥600   ¥600│ │
│ └──────┘               │ │                            │ │
│                          │ │                            │ │
│ 商品一覧                 │ │                            │ │
│ ┌────────────┐         │ └────────────────────────────┘ │
│ │コーヒー  ¥400│         │                                  │
│ │紅茶     ¥400│         │ 小計：        ¥1,400           │
│ │ジュース  ¥350│         │ 消費税(10%)：   ¥140           │
│ └────────────┘         │ ─────────────────────           │
│                          │ 合計：        ¥1,540           │
│                          │                                  │
│                          │ [現金] [カード] [電子マネー]    │
│                          │ [割り勘] [会計]                 │
└──────────────────────────┴──────────────────────────────────┘
```

### 3.3 会員管理画面

```
┌─────────────────────────────────────────────────────────────┐
│ 会員管理                                                    │
├─────────────────────────────────────────────────────────────┤
│ 検索： [氏名/電話番号/メール___________] [検索] [新規登録]  │
│                                                             │
│ ┌───────────────────────────────────────────────────────┐ │
│ │ID    氏名      電話番号        ポイント  最終来店日    │ │
│ ├───────────────────────────────────────────────────────┤ │
│ │0001  山田太郎  090-1234-5678   1,250pt  2024/01/20    │ │
│ │0002  鈴木花子  080-9876-5432     800pt  2024/01/19    │ │
│ │0003  佐藤次郎  070-1111-2222   2,100pt  2024/01/18    │ │
│ └───────────────────────────────────────────────────────┘ │
│                                                             │
│ 選択会員詳細：                                              │
│ ┌───────────────────────────────────────────────────────┐ │
│ │氏名：山田太郎    性別：男性    生年月日：1985/05/15    │ │
│ │電話：090-1234-5678  メール：yamada@example.com        │ │
│ │累計購入額：¥45,000  来店回数：23回                    │ │
│ │[編集] [購買履歴] [ポイント履歴]                       │ │
│ └───────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 3.4 レポート画面

```
┌─────────────────────────────────────────────────────────────┐
│ レポート        期間：2024/01/01 ～ 2024/01/31             │
├─────────────────────────────────────────────────────────────┤
│ [日別] [月別] [商品別] [会計レポート]                       │
│                                                             │
│ ■ 売上サマリー                                             │
│ ┌───────────────────────────────────────────────────────┐ │
│ │売上高：    ¥3,850,000   客数：     1,450人            │ │
│ │原価：      ¥1,347,500   客単価：   ¥2,655            │ │
│ │粗利：      ¥2,502,500   粗利率：    65.0%            │ │
│ └───────────────────────────────────────────────────────┘ │
│                                                             │
│ ■ 税率別集計                                               │
│ ┌───────────────────────────────────────────────────────┐ │
│ │税率    売上(税抜)    消費税      売上(税込)           │ │
│ ├───────────────────────────────────────────────────────┤ │
│ │ 8%     ¥926,852     ¥74,148     ¥1,001,000          │ │
│ │10%    ¥2,609,091    ¥260,909     ¥2,870,000          │ │
│ └───────────────────────────────────────────────────────┘ │
│                                                             │
│ [Excel出力] [PDF出力] [印刷]                               │
└─────────────────────────────────────────────────────────────┘
```

## 4. データベース設計（概要）

### 4.1 主要テーブル
- 会員マスタ
- 商品マスタ
- カテゴリマスタ
- 売上ヘッダ（伝票ヘッダ）
- 売上明細（伝票明細）
- 在庫テーブル
- 端末マスタ
- 店舗マスタ
- 返品伝票ヘッダ
- 返品伝票明細

## 5. デザイン仕様

### 5.1 対象デバイス
- タブレット端末（横向き使用）
- 推奨解像度：1024×768以上
- タッチ操作に最適化

### 5.2 UIフレームワーク
- Material Design 3準拠
- ボトムナビゲーションバーによる主要機能へのアクセス
- レスポンシブレイアウト（タブレットサイズに最適化）

### 5.3 デザインテーマ「Café Bloom」
- **コンセプト**: 洗練された女性向けカフェデザイン
- **キーワード**: エレガント、やさしい、直感的、モダン

#### 5.3.1 カラーパレット
- **プライマリカラー**: ローズゴールド (#E8B4B8)
- **セカンダリカラー**: ソフトベージュ (#F5E6D3)
- **アクセントカラー**: ダスティピンク (#D4A5A5)
- **背景色**: クリームホワイト (#FFF8F3)
- **テキスト**: チャコールグレー (#3E3E3E)
- **サブテキスト**: ミディアムグレー (#757575)

#### 5.3.2 タイポグラフィ
- **見出し**: Noto Serif JP（優雅で読みやすい）
- **本文**: Noto Sans JP（視認性重視）
- **数字**: Roboto（明確で読みやすい）

#### 5.3.3 UIコンポーネント
- **ボタン**: 角丸（16px）、ソフトシャドウ
- **カード**: 薄いドロップシャドウ、8pxパディング
- **アイコン**: Material Icons Outlined（軽やかな印象）
- **フォーム**: フローティングラベル、優しいフォーカス効果

#### 5.3.4 アニメーション
- ページ遷移：フェードイン/アウト
- ボタン：押下時の優しいスケール効果
- リスト：スタッガードアニメーション

## 6. モック版技術仕様

### 6.1 アーキテクチャ
- **完全オフライン動作**: ネットワーク接続不要
- **データストレージ**: ローカルストレージ (SharedPreferences)
- **状態管理**: Riverpod
- **デザインパターン**: Repository Pattern（将来のAPI移行に対応）

### 6.2 認証システム
- **簡易認証**: ユーザー名のみ入力
- **セッション管理**: ローカルストレージに保存
- **権限レベル**: 管理者/一般スタッフ

### 6.3 サンプルデータ
初回起動時に以下のデモデータを自動生成：

#### 商品データ（30件）
- ドリンク: 15件（コーヒー、紅茶、ジュース等）
- フード: 10件（サンドイッチ、ケーキ、パスタ等）  
- デザート: 5件

#### 会員データ（20件）
- 様々な年齢層・性別の顧客データ
- ポイント残高付き
- 購買履歴付き

#### 売上データ（過去30日分）
- 1日あたり20〜50件の売上
- 時間帯別の分散

### 6.4 Repository Pattern実装
```dart
// 抽象インターフェース
abstract class ProductRepository {
  Future<List<Product>> getAll();
  Future<Product?> getById(String id);
  Future<void> save(Product product);
}

// モック実装
class MockProductRepository implements ProductRepository {
  // ローカルストレージ使用
}

// 将来のAPI実装
class ApiProductRepository implements ProductRepository {
  // REST API使用
}
```

### 6.5 デプロイ設定

#### GitHub Pages設定
1. ビルドコマンド：`make release`
2. 自動化内容：
   - Flutter Webビルド
   - 空コミット作成（"release"メッセージ）
   - GitHub Actions起動

#### Makefile構成
```makefile
release:
	flutter build web --release
	git add .
	git commit --allow-empty -m "release"
	git push origin main
```

#### GitHub Actions設定
- ワークフロー名：Deploy to GitHub Pages
- トリガー：mainブランチへのpush（"release"コミット時）
- ビルドとデプロイの自動実行

## 7. 技術仕様

### 7.1 開発環境
- Flutter (Web対応)
- Dart
- 状態管理：Riverpod
- ローカルストレージ：SharedPreferences
- ルーティング：go_router

### 7.2 開発ツール
- IDE: VS Code / Android Studio
- バージョン管理：Git
- CI/CD: GitHub Actions

### 7.3 パフォーマンス要件
- 初回ロード：3秒以内
- ページ遷移：500ms以内
- 検索レスポンス：200ms以内

## 8. 今後の拡張予定
- API統合（クラウド同期）
- モバイルオーダー連携
- 予約管理機能
- 顧客分析AI機能
- 多店舗管理
- PWA対応